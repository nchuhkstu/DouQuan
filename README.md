# 抖圈 为用户提供多元化服务的娱乐平台

[TOC]

## 项目介绍

​	

抖圈是一个面向所有年龄段、所有人群的娱乐平台，它提供了丰富多样的娱乐内容和功能，旨在满足不同人群的需求和兴趣。抖圈提供了时尚、潮流、音乐和舞蹈等内容，他们可以与朋友分享自己的才艺表演，参与挑战活动，与偶像互动，甚至通过抖圈平台展示自己的创造力和才华。可以欣赏到各种精彩的表演和创意，了解最新的娱乐资讯，与其他用户分享自己的兴趣爱好，并与朋友、家人保持联系。参与各种生活趣味的分享与交流。抖圈为他们提供了一个社交和娱乐的平台，让他们在互动中找到快乐和满足感。总的来说，抖圈致力于为所有年龄段的用户提供一个安全、多元化和富有乐趣的娱乐平台，让每个人都能在这个平台上找到适合自己的娱乐内容，并与其他用户分享和交流。

除此之外，抖圈还是本人的第一个采用微服务方案实现分布式架构的项目，不仅想将自己学到的微服务技术实践一遍，更想做一个长久的、可用的东西。因此在开发时遇到认为设计不合理的地方会推倒重来，只为总结经验，理解不同设计方案下的优缺点，而不是为了快速实现，这样项目才更好迭代和维护，做出来的东西也才能更加长久。



## 需求分析

### 功能需求

抖圈功能包含动态、短视频、直播、在线聊天等几大主要功能，同时，在数据上，应该尽可能的存储所有数据。

​		

| 模块       |    功能    | 描述                                                         |
| :--------- | :--------: | :----------------------------------------------------------- |
| 用户模块   |    登录    | 登录系统                                                     |
|            |    注册    | 注册账号                                                     |
|            |  修改资料  | 用户修改资料，包括用户名、头像等                             |
|            |  修改账户  | 用户修改登录账号、密码                                       |
|            |  隐私设置  | 用户设置是否让他人查看自己的动态，是否接受陌生人私聊等       |
|            |  个人空间  | 用户查看自己的所有信息，包括扩展资料，发布的动态、短视频、关注的用户、拥有的粉丝等 |
|            |    相册    | 用户可以拥有一个相册，将会在个人空间里展示                   |
|            |    关注    | 用户可以关注其它用户，互相关注后成为朋友                     |
| 动态模块   |  发布动态  | 用户发布动态，发布时可以带上图片                             |
|            |  删除动态  | 用户删除自己的动态                                           |
|            |  热门动态  | 主页显示热门的动态，通过一定的算法来选取                     |
|            |  动态点赞  | 用户可以给所有动态点赞，仅限一次，也可以取消点赞             |
|            |  动态评论  | 用户可以给所有动态评论，不限次数，可以删除自己的评论         |
|            |  动态转发  | 用户可以将所有的动态转发给自己的朋友                         |
|            |            |                                                              |
| 短视频模块 | 发布短视频 | 用户发布短视频，可以设置短视频的封面                         |
|            | 删除短视频 | 用户删除自己的短视频                                         |
|            | 热门短视频 | 主页显示热门的短视频，通过一定的算法来选取                   |
|            | 短视频点赞 | 用户可以给所有的短视频点赞，仅限一次，可以取消点赞           |
|            | 短视频评论 | 用户可以给所有短视频评论，不限次数，可以删除自己的评论       |
|            | 短视频转发 | 用户可以将所有的短视频转发给自己的朋友                       |
| 点赞模块   |  动态点赞  | 给动态点赞                                                   |
|            | 短视频点赞 | 给短视频点赞                                                 |
|            |  评论点赞  | 给评论点赞                                                   |
| 评论模块   |  动态评论  | 给动态评论                                                   |
|            | 短视频评论 | 给短视频评论                                                 |
| 转发模块   |  动态转发  | 转发动态给朋友                                               |
|            | 短视频转发 | 转发短视频给朋友                                             |
|            |  评论转发  | 转发评论给朋友，无论是动态的评论还是短视频的评论，都可以     |
| 图片模块   |  图片上传  | 用户通过发布动态、发布短视频时的封面、修改头像或者上传图片至相册时都可以完成图片上传 |
|            |  图片展示  | 将上传的图片动过动态、短视频、头像、相册等方式进行展示。     |
|            |  图片删除  | 在删除动态、短视频、相册、注销账号时都会完成图片的删除。     |
| 消息模块   |  在线聊天  | 用户之间通过私聊在线聊天                                     |
|            |  系统消息  | 在完成某些操作之后系统会提示消息                             |
| 视频模块   |  视频上传  | 用户通过发布短视频时会完成视频的上传                         |
|            |  视频处理  | 当视频上传后会进行多个画质的压缩、分段处理。                 |
|            |  视频展示  | 在播放短视频时进行视频的展示                                 |

### 性能需求

页面跳转：<100 ms

查询热门文章、热门短视频、查看用户会话：<500 ms

其它：<200 ms

### 界面需求

所有的功能都在一个页面上，用户无需跳转即可享受所有功能，一些额外功能采用模态框的方式进行展示，一些操作会导致页面刷新重新渲染。



## 系统设计

### 数据库设计

分布式架构采用分布式数据库，每一个微服务对应一个数据库。对于数据库表，将点赞、评论等这些有多个实体所对应的，就进行垂直拆分，将大表拆成小表，减少一个表的字段。例如动态和短视频都有点赞功能，因此动态点赞关系和短视频点赞关系都不存在动态表和短视频表里，而是另立新表，将点赞信息单独成表，动态点赞和用户点赞通过点赞表相联系。

总共8个数据库31张表

| 数据库名   | 表名                 |
| ---------- | -------------------- |
| user       | user_account         |
|            | user_article         |
|            | user_avatar          |
|            | user_conversation    |
|            | user_extend          |
|            | user_fan             |
|            | user_login           |
|            | user_photo           |
|            | user_shortvideo      |
| article    | article              |
|            | article_comment      |
|            | article_like         |
|            | article_photo        |
|            | article_relay        |
|            | article_view         |
| shortvideo | shortvideo           |
|            | shortvideo_comment   |
|            | shortvideo_like      |
|            | shortvideo_photo     |
|            | shortvideo_relay     |
|            | shortvideo_video     |
|            | shortvideo_view      |
| photo      | photo                |
| video      | video                |
| like       | like                 |
| comment    | comment              |
|            | comment_like         |
|            | comment_photo        |
| chat       | conversation         |
|            | conversation_message |
|            | message              |

### 微服务设计

项目的后端目前总共拥有用户服务、动态服务、短视频服务、点赞服务、评论服务、视频服务、图片服务、消息服务、网关服务等九个微服务。

核心服务为：网关服务、用户服务、动态服务、短视频服务、消息服务

非核心服务为：点赞服务、评论服务、视频服务、图片服务

这里所说的核心服务与非核心服务指的是，核心服务会去调用其它服务或被其它服务所调用，而非核心服务只会被其它服务所调用。

服务间调用关系举例如下，

查询用户的动态时，需要从网关服务去到用户服务，再由用户服务去调用动态服务，动态服务再去调用点赞服务、评论服务、图片服务，最终将所有查到的内容返回。



### 页面设计

整个平台就一个页面，采用组件替换、组件激活的方式来展示不同的功能，页面布局参考了抖音、微博、QQ等，目前页面呈暗色系风格。



## 技术架构

### 前端技术

前端基于Vue2，使用Vite构建，使用Axios库发起http请求，socketio实现在线聊天



### 后端技术

采用主流的Spring Cloud技术，包括Nacos、Gateway、Feign、RabbitMQ、MyBatis-Plus、MySql、Nginx、FFmpeg。

Nacos：注册中心和配置中心。

Gatewa：网关。

Fegin：微服务发起远程调用。

RabbitMQ：消息队列。

MyBatis-Plus：数据层的ORM框架，方便单表的处理。

MySql：数据库。

Nginx：管理图片和视频资源。

FFmpeg：对视频进行多个画质的压缩和分段处理。

## 上线部署

目前是5台云服务器，拥有9个微服务，9个数据库和3个中间件。

服务器详细信息如下

| 序号 | 平台   | 配置                  | 地区 | 过期时间  |
| ---- | ------ | --------------------- | ---- | --------- |
| 1    | 腾讯云 | 2核4G5M               | 上海 | 2024.8.27 |
| 2    | 阿里云 | 2核2G100M（流量限制） | 广州 | 2024.7.24 |
| 3    | 阿里云 | 2核2G100M（流量限制） | 广州 | 2024.7.24 |
| 4    | 阿里云 | 2核2G3M               | 广州 | 2025.4.25 |
| 5    | 华为云 | 2核2G2M               | 广州 | 2025.4.24 |

因1号服务器与其它服务器不在同地区，为减小延迟，所以将Nacos注册中心、配置中心、RabbitMQ、SocketIO服务器等延迟敏感低的服务放到1号服务器。

视频服务因在处理视频时需要占用大量CPU，并且上传时需要高带宽，所以将视频服务单独放到2号服务器

前端在用户第一次访问时也需要将大量的html、css等文件传递给用户，因此将其放到高带宽的3号服务器上

最终服务部署情况如下

| 服务器序号 | 服务                                              |
| ---------- | ------------------------------------------------- |
| 1          | Nacos配置中心、注册中心，RabbitMQ、SocketIO服务器 |
| 2          | 视频服务                                          |
| 3          | 前端服务、评论服务、点赞服务、图片服务            |
| 4          | 短视频服务、网关服务、消息服务                    |
| 5          | 用户服务、动态服务                                |

