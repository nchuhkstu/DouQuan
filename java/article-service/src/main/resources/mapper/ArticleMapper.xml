<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nchu.mapper.ArticleMapper">

    <resultMap id="BaseResultMap" type="com.nchu.pojo.Article">
            <id property="articleid" column="articleid" jdbcType="INTEGER"/>
            <result property="title" column="title" jdbcType="VARCHAR"/>
            <result property="content" column="content" jdbcType="VARCHAR"/>
            <result property="publishtime" column="publishTime" jdbcType="TIMESTAMP"/>
    </resultMap>

    <sql id="Base_Column_List">
        articleid,title,content,
        publishTime
    </sql>
    <select id="findByPageHot" resultType="java.lang.Integer">
        SELECT a.articleid
        FROM article.article a
        LEFT JOIN (
            SELECT articleid, COUNT(*) AS view_count
            FROM article_view
            GROUP BY articleid
        ) v ON a.articleid = v.articleid
        LEFT JOIN(
            SELECT articleid, COUNT(*) AS like_count
            FROM article_like
            GROUP BY articleid
        ) l ON a.articleid = l.articleid
        LEFT JOIN (
            SELECT articleid, COUNT(*) AS comment_count
            FROM article_comment
            GROUP BY articleid
        )c ON a.articleid = c.articleid
        LEFT JOIN(
            SELECT articleid,COUNT(*) AS relay_count
            FROM article_comment
            GROUP BY articleid
        )r ON a.articleid = r.articleid
        ORDER BY (1+COALESCE(v.view_count, 0) + COALESCE(l.like_count, 0) + COALESCE(c.comment_count, 0) + COALESCE(r.relay_count, 0)) * (1 / (1 + TIMESTAMPDIFF(MINUTE , a.publishTime, NOW()))) DESC
    </select>
</mapper>
